# Cursor Rules for TinyBigUI

You are developing TinyBigUI, an open-source Material Design 3 React component library with accessibility-first principles.

## Core Principles

- **Quality over speed**: Build it right, not fast
- **Accessibility first**: WCAG 2.1 AA is non-negotiable
- **MD3 strict adherence**: Follow Material Design 3 specifications exactly
- **TypeScript strict mode**: No `any` types allowed
- **RSC compatible**: Explicit `'use client'` for interactive components

## Tech Stack

- **React**: 18+ with RSC support
- **TypeScript**: Strict mode enabled
- **Tailwind CSS**: v4.x (CSS-first tokens via `@theme`)
- **React Aria**: For accessibility primitives
- **CVA**: For component variant management
- **Vitest + RTL**: For testing
- **Storybook**: For documentation (Next.js primary, Vite secondary)

## ğŸŒ Tailwind CSS v4 Handling (CRITICAL)

**IMPORTANT**: AI training data is from April 2024 (before Tailwind v4 stable release).

**MANDATORY RULE for ANY Tailwind CSS related task**:

1. ğŸ” **ALWAYS search the web first** for current Tailwind CSS v4 documentation
2. âœ… Use latest official docs from tailwindcss.com
3. âœ… Verify syntax, configuration, and best practices are v4-compatible
4. âœ… Check for breaking changes from v3 â†’ v4
5. âŒ NEVER rely solely on training data for Tailwind v4 specifics

**Tasks requiring web search**:
- Installation and setup
- Configuration (CSS `@theme`, PostCSS, etc.)
- CSS-first token integration
- Framework-specific integration (Next.js, Vite, etc.)
- Any `@import`, `@theme`, `@apply` syntax
- Browser requirements and compatibility
- Plugin usage and configuration
- Content scanning/detection mechanisms

**Search terms to use**:
- "Tailwind CSS v4 [specific feature] documentation"
- "Tailwind CSS v4 [framework] setup guide"
- "Tailwind CSS v4 migration from v3"

## Project Structure

```
tinybigui/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ react/          # @tinybigui/react - Components
â”‚   â””â”€â”€ tokens/         # @tinybigui/tokens - Design tokens (CSS)
```

**Component file structure** (REQUIRED for every component):

```
component-name/
â”œâ”€â”€ component-name.tsx              # Main styled component
â”œâ”€â”€ component-name-headless.tsx     # Headless primitive
â”œâ”€â”€ component-name.variants.ts      # CVA variants
â”œâ”€â”€ component-name.types.ts         # TypeScript types
â”œâ”€â”€ component-name.test.tsx         # Tests
â”œâ”€â”€ component-name.stories.tsx      # Storybook
â””â”€â”€ index.ts                        # Public exports
```

## Code Style

### TypeScript

- âœ… MUST use strict mode (no `any`)
- âœ… MUST use explicit types for all props/functions
- âœ… MUST use JSDoc for all public APIs (include @default, @example)
- âœ… MUST use `forwardRef` for components accepting refs
- âœ… MUST use `const` assertions for literal arrays
- âŒ NEVER use default exports
- âŒ NEVER skip type annotations

### React

- âœ… MUST add `'use client'` to all interactive components
- âœ… MUST use Tailwind CSS (never inline styles or CSS-in-JS)
- âœ… MUST use `cn()` utility for className merging
- âœ… MUST destructure props
- âŒ NEVER use default exports
- âŒ NEVER use inline styles

### React Aria Integration

- âœ… MUST use React Aria hooks for all interactive components
- âœ… MUST let React Aria handle accessibility (ARIA, keyboard, focus)
- âŒ NEVER implement keyboard/ARIA logic manually
- âŒ NEVER skip React Aria hooks

Example:
```typescript
'use client'
import { useButton } from 'react-aria'
import { forwardRef, useRef } from 'react'

function ButtonHeadless(props: ButtonProps) {
  const ref = useRef(null)
  const { buttonProps } = useButton(props, ref)
  return <button {...buttonProps} ref={ref} />
}
```

### CVA (Class Variance Authority)

- âœ… MUST use CVA for all component variants
- âœ… MUST define variants in separate `.variants.ts` file
- âœ… MUST export `VariantProps` type
- âœ… MUST provide `defaultVariants`
- âŒ NEVER handle variants with conditional className logic

Example:
```typescript
// button.variants.ts
import { cva, type VariantProps } from 'class-variance-authority'

export const buttonVariants = cva(
  'base-classes',
  {
    variants: {
      variant: {
        filled: 'bg-primary text-on-primary',
        outlined: 'border-2 border-outline',
      },
      size: {
        small: 'h-10 px-4',
        medium: 'h-12 px-6',
      },
    },
    defaultVariants: {
      variant: 'filled',
      size: 'medium',
    },
  }
)

export type ButtonVariants = VariantProps<typeof buttonVariants>
```

## Material Design 3 Rules

### Design Tokens

- âœ… MUST use MD3 design tokens via Tailwind classes (`bg-primary`, `text-on-primary`)
- âœ… MUST follow MD3 specifications exactly
- âœ… MUST use MD3 elevation classes (`shadow-elevation-1`)
- âœ… MUST use MD3 typography classes (`text-headline-large`)
- âŒ NEVER use arbitrary color values (`bg-[#6750a4]`)
- âŒ NEVER deviate from MD3 specs

### Component Variants

- âœ… MUST implement ALL MD3 variants for each component
- âœ… MUST use MD3 naming (e.g., 'filled', 'outlined' NOT 'solid', 'bordered')
- âŒ NEVER create custom variants not in MD3 spec
- âŒ NEVER skip MD3 variants

### Interactions

- âœ… MUST implement MD3 state layers
- âœ… MUST use MD3 motion tokens (`transition-all duration-short2 ease-standard`)
- âœ… MUST implement ripple effect where specified
- âŒ NEVER use custom animations not in MD3

## Accessibility Rules (WCAG 2.1 AA)

- âœ… MUST meet WCAG 2.1 AA minimum (aim for AAA where feasible)
- âœ… MUST ensure 4.5:1 contrast for text, 3:1 for UI components
- âœ… MUST provide accessible labels for all interactive elements
- âœ… MUST support keyboard navigation (Tab, Enter, Space)
- âœ… MUST show visible focus indicators (never remove)
- âœ… MUST let React Aria handle ARIA attributes
- âœ… MUST add `aria-label` for icon-only components
- âœ… MUST use semantic HTML when possible
- âŒ NEVER skip accessibility attributes
- âŒ NEVER rely on color alone for information
- âŒ NEVER create keyboard traps
- âŒ NEVER add redundant ARIA (React Aria handles it)

## Testing Rules

### Required Tests

Every component MUST have:
1. Rendering tests (default props, all variants)
2. Interaction tests (click, keyboard)
3. Accessibility tests (axe violations)
4. Customization tests (className merging)

Example structure:
```typescript
describe('Button', () => {
  describe('Rendering', () => {
    it('renders with default props', () => { })
    it('renders all variants', () => { })
  })
  
  describe('Interactions', () => {
    it('handles click events', async () => { })
    it('handles keyboard navigation', async () => { })
  })
  
  describe('Accessibility', () => {
    it('has no violations', async () => {
      const { container } = render(<Button>Click</Button>)
      const results = await axe(container)
      expect(results).toHaveNoViolations()
    })
  })
  
  describe('Customization', () => {
    it('merges custom className', () => { })
  })
})
```

- âœ… MUST write tests for every component
- âœ… MUST include axe accessibility tests
- âœ… MUST achieve >90% code coverage
- âœ… MUST test edge cases and error states
- âŒ NEVER skip tests (even for "simple" components)
- âŒ NEVER skip accessibility tests

## Documentation Rules

### Storybook Stories

Every component MUST have:
- `Default` story
- `Variants` story (all MD3 variants)
- `Sizes` story (if applicable)
- `States` story (hover, focus, disabled)
- `WithIcons` story (if applicable)
- `Accessibility` story
- `Interactive` story with play function

- âœ… MUST create all standard stories
- âœ… MUST include accessibility story
- âœ… MUST include interactive tests (play function)
- âŒ NEVER skip Storybook documentation

### JSDoc

```typescript
interface ButtonProps {
  /**
   * The visual style of the button
   * @default 'filled'
   */
  variant?: 'filled' | 'outlined'
  
  /**
   * Handler called when button is pressed
   */
  onPress?: () => void
}
```

- âœ… MUST add JSDoc to all public APIs
- âœ… MUST document @default values
- âœ… MUST include @example where helpful
- âŒ NEVER skip JSDoc for public APIs

## Import/Export Rules

### Import Order

```typescript
// 1. React imports
import { forwardRef } from 'react'

// 2. External libraries
import { useButton } from 'react-aria'
import { cva } from 'class-variance-authority'

// 3. Internal components
import { Icon } from '../icon'

// 4. Internal utilities
import { cn } from '../../utils/cn'

// 5. Types (use `import type`)
import type { ButtonProps } from './button.types'
```

### Exports

- âœ… MUST use named exports only
- âœ… MUST use `export type` for types
- âœ… MUST re-export from `index.ts`
- âŒ NEVER use default exports
- âŒ NEVER export implementation details

## Commit Rules (Conventional Commits)

Format: `type(scope): description`

Types: `feat`, `fix`, `docs`, `style`, `refactor`, `perf`, `test`, `chore`

Examples:
```bash
feat(button): add loading state
fix(textfield): resolve focus ring color
docs(readme): update installation steps
test(checkbox): add keyboard navigation tests
```

- âœ… MUST use conventional commit format
- âœ… MUST include component scope
- âœ… MUST write descriptive messages
- âŒ NEVER use generic messages ("fixes", "update stuff", "wip")

## Forbidden Patterns (NEVER DO)

```typescript
// âŒ Default exports
export default Button

// âŒ any type
function Button(props: any) { }

// âŒ Inline styles
<button style={{ color: 'red' }} />

// âŒ Manual accessibility
<button onClick={() => {}} onKeyDown={(e) => { }} />

// âŒ Arbitrary values for MD3 tokens
<button className="bg-[#6750a4]" />

// âŒ Missing 'use client' for interactive components
export function Button() { } // Missing directive

// âŒ Non-MD3 variants
<Button variant="fancy" /> // Not in MD3 spec

// âŒ Skip tests
// "This component is too simple to test"

// âŒ Skip accessibility
// "We'll add a11y later"
```

## Required Patterns (ALWAYS DO)

```typescript
// âœ… Named exports
export { Button } from './button'

// âœ… Explicit types
interface ButtonProps extends AriaButtonProps { }

// âœ… 'use client' for interactive components
'use client'
export function Button() { }

// âœ… React Aria
const { buttonProps } = useButton(props, ref)

// âœ… CVA for variants
const buttonVariants = cva(...)

// âœ… MD3 design tokens
<button className="bg-primary text-on-primary" />

// âœ… Write tests
describe('Button', () => { })

// âœ… Write Storybook stories
export const Default: Story = { }

// âœ… JSDoc documentation
/** Button component following MD3 */

// âœ… Accessibility first
it('has no a11y violations', async () => { })
```

## Pre-Change Checklist

Before suggesting ANY code change, verify:

1. âœ… Follows monorepo structure?
2. âœ… Uses TypeScript strict mode?
3. âœ… Follows naming conventions (kebab-case files)?
4. âœ… Uses React Aria for accessibility?
5. âœ… Uses CVA for variants?
6. âœ… Follows MD3 specifications?
7. âœ… Includes `'use client'` if needed?
8. âœ… Includes tests (unit + accessibility)?
9. âœ… Includes Storybook stories?
10. âœ… Includes JSDoc?
11. âœ… Follows import/export rules?
12. âœ… Is accessible (WCAG 2.1 AA)?

**If answer is "No" to any â†’ Don't suggest it!**

## Reference Priority

When answering questions, consult in this order:

1. Strategy docs (`strategies/` folder)
2. Material Design 3 specs (m3.material.io)
3. React Aria docs (react-spectrum.adobe.com/react-aria)
4. WCAG guidelines (w3.org/WAI/WCAG21)
5. General best practices

## Core Philosophy

**When in doubt, prioritize: Accessibility > Consistency > Convenience**

All code must be:
- âœ… Consistent across the project
- âœ… Meeting quality standards
- âœ… Accessible (never compromised)
- âœ… Following MD3 specifications
- âœ… Providing excellent DX
- âœ… Maintainable long-term

